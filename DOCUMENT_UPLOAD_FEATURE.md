# صفحة رفع المستندات - تطبيق حقوقي

## نظرة عامة
تم إنشاء نظام شامل لرفع وإدارة المستندات في تطبيق حقوقي، يتيح للمستخدمين رفع مستنداتهم بطريقة آمنة ومنظمة.

## الميزات المُنجزة

### 1. خدمة تخزين المستندات (`DocumentStorageService`)
- ✅ رفع الملفات إلى Supabase Storage
- ✅ ضغط الصور تلقائياً لتوفير المساحة
- ✅ التحقق من أنواع وأحجام الملفات
- ✅ إنشاء مسارات آمنة للملفات حسب نوع المستند
- ✅ حفظ معلومات المستندات في قاعدة البيانات
- ✅ حذف المستندات (خلال 24 ساعة من الرفع)

### 2. مقدم إدارة المستندات (`DocumentProvider`)
- ✅ إدارة حالة المستندات باستخدام Provider
- ✅ اختيار الصور من المعرض
- ✅ التقاط الصور بالكاميرا
- ✅ اختيار ملفات PDF
- ✅ طلب الأذونات المطلوبة تلقائياً
- ✅ التحقق من صحة الملفات قبل الرفع
- ✅ تتبع تقدم الرفع والأخطاء

### 3. شاشة رفع المستندات (`DocumentUploadScreen`)
- ✅ واجهة مستخدم بديهية وسهلة الاستخدام
- ✅ شريط تقدم يُظهر نسبة إكمال رفع المستندات
- ✅ نموذج لاختيار نوع المستند وإضافة وصف
- ✅ خيارات متعددة للرفع (معرض، كاميرا، ملفات)
- ✅ عرض الملف المحدد قبل الرفع
- ✅ قائمة المستندات المرفوعة مع إمكانية الحذف
- ✅ رسائل خطأ واضحة ومفيدة

### 4. شاشة عرض المستندات (`DocumentViewScreen`)
- ✅ عرض شامل لجميع المستندات المرفوعة
- ✅ شريط إحصائيات يُظهر عدد المستندات والتحقق
- ✅ تجميع المستندات حسب النوع
- ✅ عرض تفاصيل كل مستند (حجم، تاريخ، حالة)
- ✅ خيارات إدارة المستندات (عرض، حذف)
- ✅ مؤشرات بصرية لحالة التحقق

### 5. قاعدة البيانات
- ✅ جدول `documents` مع جميع الحقول المطلوبة
- ✅ سياسات أمان (RLS) شاملة
- ✅ فهارس لتحسين الأداء
- ✅ محفزات لتحديث البيانات تلقائياً
- ✅ قيود للتحقق من صحة البيانات
- ✅ Views للإحصائيات والتقارير

### 6. التكامل مع النظام
- ✅ إضافة المسارات إلى `AppRouter`
- ✅ إضافة `DocumentProvider` إلى قائمة Providers
- ✅ تحديث الشاشة الرئيسية لتشمل أزرار المستندات
- ✅ التكامل مع البيانات الشخصية

## أنواع المستندات المدعومة

### الصور
- **الأنواع المدعومة**: JPG, JPEG, PNG
- **الحد الأقصى للحجم**: 5 ميجابايت
- **المعالجة**: ضغط تلقائي للصور

### المستندات
- **الأنواع المدعومة**: PDF
- **الحد الأقصى للحجم**: 10 ميجابايت
- **المعالجة**: حفظ مباشر بدون تعديل

## أنواع المستندات المطلوبة

1. **الصورة الشخصية** (`personalPhoto`)
2. **وثائق دائرة شؤون العراقي** (`iraqiAffairsDept`)
3. **وثائق منفذ الهجرة الكويتية** (`kuwaitImmigration`)
4. **إقامة سارية المفعول** (`validResidence`)
5. **وثائق الصليب الأحمر الدولي** (`redCrossInternational`)
6. **أخرى** (`other`) - اختياري

## هيكل التخزين في Supabase

```
user-documents/
├── {user_id}/
│   ├── profile/
│   │   └── personalPhoto_*.jpg
│   └── official-documents/
│       ├── iraqi-affairs/
│       │   └── iraqiAffairsDept_*.pdf
│       ├── kuwait-immigration/
│       │   └── kuwaitImmigration_*.pdf
│       ├── residence-permit/
│       │   └── validResidence_*.pdf
│       ├── red-cross/
│       │   └── redCrossInternational_*.pdf
│       └── other/
│           └── other_*.pdf
```

## الأمان والحماية

### سياسات Row Level Security (RLS)
- المستخدم يرى مستنداته فقط
- المستخدم يستطيع رفع مستندات لبياناته الشخصية فقط
- إمكانية الحذف محدودة بـ 24 ساعة من الرفع
- المشرفون يمكنهم إدارة جميع المستندات

### التحقق من البيانات
- فحص أنواع الملفات المسموحة
- فحص أحجام الملفات
- منع رفع أكثر من مستند واحد من نفس النوع
- التحقق من صحة البيانات المُدخلة

## الاستخدام

### رفع مستند جديد
1. الذهاب إلى شاشة رفع المستندات
2. اختيار نوع المستند
3. إضافة وصف (اختياري)
4. اختيار الملف (معرض، كاميرا، أو ملف)
5. النقر على "رفع المستند"

### عرض المستندات
1. الذهاب إلى شاشة عرض المستندات
2. استعراض المستندات مجمعة حسب النوع
3. عرض تفاصيل أي مستند
4. إدارة المستندات (عرض، حذف)

## المتطلبات التقنية

### المكتبات المستخدمة
- `supabase_flutter`: للتفاعل مع Supabase
- `image_picker`: لاختيار الصور والتقاط الصور
- `file_picker`: لاختيار الملفات
- `flutter_image_compress`: لضغط الصور
- `permission_handler`: لإدارة الأذونات
- `provider`: لإدارة الحالة
- `path`: للتعامل مع مسارات الملفات

### الأذونات المطلوبة
- إذن الوصول للكاميرا
- إذن الوصول لمعرض الصور
- إذن الوصول للملفات

## المهام المستقبلية

### تحسينات مقترحة
- [ ] عارض مستندات متقدم (PDF viewer, Image viewer)
- [ ] إمكانية تعديل المستندات
- [ ] رفع متعدد للملفات
- [ ] معاينة المستند قبل الرفع
- [ ] إضافة watermark للصور
- [ ] نظام تنبيهات للمستندات المرفوضة
- [ ] إمكانية تصدير المستندات
- [ ] البحث والفلترة في المستندات

### تحسينات الأداء
- [ ] تحسين ضغط الصور
- [ ] رفع تدريجي للملفات الكبيرة
- [ ] تخزين مؤقت للصور المصغرة
- [ ] تحسين استعلامات قاعدة البيانات

## الملاحظات المهمة

1. **الأمان**: جميع المستندات محمية بسياسات RLS صارمة
2. **الحد الأقصى**: يُسمح برفع مستند واحد فقط من كل نوع مطلوب
3. **الحذف**: يمكن حذف المستندات خلال 24 ساعة فقط من الرفع
4. **الضغط**: الصور تُضغط تلقائياً لتوفير المساحة
5. **التحقق**: يتم التحقق من المستندات من قبل المشرفين

## دعم المطورين

للحصول على المساعدة أو الإبلاغ عن مشاكل:
- راجع ملفات التوثيق في مجلد `database/`
- تحقق من رسائل الخطأ في وحدة التحكم
- تأكد من تشغيل SQL scripts في Supabase قبل الاستخدام
