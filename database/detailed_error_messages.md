# رسائل الخطأ المحدثة - تفصيلية ودقيقة

## التحديثات المطبقة

تم تحديث نظام معالجة الأخطاء ليكون أكثر تحديداً ووضوحاً للمستخدم. الآن بدلاً من الرسالة العامة "بعض البيانات المدخلة غير صحيحة"، سيحصل المستخدم على رسائل محددة تشير إلى المشكلة بالضبط.

## رسائل الأخطاء الجديدة

### 1. أخطاء البيانات المطلوبة (Not Null Violations)

#### الحقول الأساسية:
- **الاسم الكامل**: "يرجى إدخال الاسم الكامل في العراق."
- **اسم الأم**: "يرجى إدخال اسم الأم."
- **المحافظة**: "يرجى اختيار المحافظة الحالية."
- **تاريخ الميلاد**: "يرجى إدخال تاريخ الميلاد."
- **مكان الولادة**: "يرجى إدخال مكان الولادة."
- **رقم الهاتف**: "يرجى إدخال رقم الهاتف."

#### بيانات الهوية:
- **رقم الهوية**: "يرجى إدخال رقم الهوية الوطنية."
- **سنة الإصدار**: "يرجى إدخال سنة إصدار الهوية الوطنية."
- **جهة الإصدار**: "يرجى إدخال جهة إصدار الهوية الوطنية."

### 2. أخطاء قيود البيانات (Check Constraint Violations)

#### طريقة الخروج من الكويت:
```
يرجى اختيار طريقة صحيحة للخروج من الكويت من الخيارات المتاحة:
• المغادرة الطوعية
• الترحيل القسري
• التهريب البري
• قبل انسحاب الجيش
```

#### نوع التعويض:
```
يرجى اختيار نوع تعويض صحيح من الخيارات المتاحة:
• خدمات الوظائف الحكومية
• الأثاث والممتلكات الشخصية
• التعويض المعنوي
• تعويض السجن
```

#### نوع العمل في الكويت:
```
يرجى اختيار نوع عمل صحيح في الكويت من الخيارات المتاحة:
• موظف مدني
• موظف عسكري
• طالب
• عمل حر
```

#### الوضع الرسمي في الكويت:
```
يرجى اختيار الوضع الرسمي الصحيح في الكويت:
• مقيم
• بدون
```

#### نوع طلب الحقوق:
```
يرجى اختيار نوع طلب حقوق صحيح من الخيارات المتاحة:
• راتب التقاعد
• أرض سكنية
```

### 3. أخطاء التحقق المسبق (Client-side Validation)

#### سنة إصدار الهوية:
- "سنة إصدار الهوية الوطنية غير صحيحة. يرجى إدخال سنة بين 1950 و 2025."

#### عدد أفراد الأسرة:
- "عدد أفراد الأسرة يجب أن يكون رقماً موجباً أو صفر."
- "عدد البالغين فوق 18 سنة يجب أن يكون رقماً موجباً أو صفر."
- "عدد البالغين فوق 18 سنة لا يمكن أن يتجاوز عدد أفراد الأسرة الإجمالي."

#### تاريخ الميلاد:
- "تاريخ الميلاد لا يمكن أن يكون في المستقبل."
- "تاريخ الميلاد غير منطقي. يرجى التحقق من التاريخ المدخل."
- "العمر صغير جداً. يرجى التحقق من تاريخ الميلاد."
- "تنسيق تاريخ الميلاد غير صحيح. يرجى إدخال تاريخ صحيح."

#### رقم الهاتف:
- "رقم الهاتف غير صحيح. يرجى إدخال رقم هاتف صحيح (10-15 رقم)."

## مميزات النظام الجديد

### 1. تحديد دقيق للمشكلة
- بدلاً من رسالة عامة، كل خطأ له رسالة محددة
- يتم تحديد الحقل المشكلة بالضبط
- شرح واضح لما يجب فعله

### 2. تحقق مسبق من البيانات
- فحص البيانات قبل إرسالها إلى قاعدة البيانات
- تجنب أخطاء الخادم غير الضرورية
- تجربة مستخدم أفضل

### 3. رسائل بالعربية واضحة
- جميع الرسائل بالعربية الفصيحة
- توضيح الخيارات المتاحة للمستخدم
- إرشادات واضحة لحل المشكلة

### 4. معالجة شاملة للأخطاء
- أخطاء قاعدة البيانات
- أخطاء التحقق من صحة البيانات
- أخطاء تنسيق البيانات
- أخطاء منطق العمل

## أمثلة على السيناريوهات

### مثال 1: خطأ في طريقة الخروج
**قبل**: "بعض البيانات المدخلة غير صحيحة. يرجى مراجعة البيانات والمحاولة مرة أخرى."

**بعد**: 
```
طريقة الخروج من الكويت غير صحيحة. يرجى اختيار من الخيارات المتاحة:
• المغادرة الطوعية
• الترحيل القسري
• التهريب البري
• قبل انسحاب الجيش
```

### مثال 2: خطأ في العمر
**قبل**: "بعض البيانات المدخلة غير صحيحة."

**بعد**: "العمر صغير جداً. يرجى التحقق من تاريخ الميلاد."

### مثال 3: خطأ في عدد أفراد الأسرة
**قبل**: "بعض البيانات المدخلة غير صحيحة."

**بعد**: "عدد البالغين فوق 18 سنة لا يمكن أن يتجاوز عدد أفراد الأسرة الإجمالي."

## كيفية عمل النظام

### 1. التحقق المسبق (Client-side)
```dart
// فحص البيانات قبل الإرسال
final validationError = _validateData(personalDataMap);
if (validationError != null) {
  _setError(validationError);
  return false;
}
```

### 2. معالجة أخطاء قاعدة البيانات (Server-side)
```dart
// معالجة أخطاء PostgreSQL
on PostgrestException catch (e) {
  final errorMessage = _handlePostgrestError(e);
  _setError(errorMessage);
  return false;
}
```

### 3. تحليل نوع الخطأ
```dart
// تحديد نوع الخطأ بدقة
if (message.contains('exit_method')) {
  return 'طريقة الخروج من الكويت غير صحيحة...';
}
```

## فوائد للمستخدم

1. **وضوح المشكلة**: يعرف المستخدم بالضبط ما المشكلة
2. **سهولة الحل**: إرشادات واضحة لحل المشكلة
3. **توفير الوقت**: لا حاجة للتخمين
4. **تجربة أفضل**: أقل إحباطاً وأكثر فهماً

## فوائد للمطور

1. **صيانة أسهل**: أخطاء محددة أسهل للتتبع
2. **دعم فني أقل**: المستخدمون يفهمون المشاكل
3. **جودة البيانات**: التحقق المسبق يمنع البيانات الخاطئة
4. **تجربة مستخدم محسنة**: رضا أكبر من المستخدمين
